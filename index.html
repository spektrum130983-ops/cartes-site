<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Ma Collection de Boosters</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding-top: 60px;
  background: #ffe4e1;
}

#navbar {
  position: fixed;
  top: 0;
  width: 100%;
  background: linear-gradient(135deg, #f8cdda, #1d2b64);
  padding: 10px;
  display: flex;
  justify-content: center;
  gap: 20px;
  z-index: 10000;
}

#navbar a {
  color: white;
  font-weight: bold;
  text-decoration: none;
}

header {
  text-align: center;
  padding: 20px;
  background: linear-gradient(135deg, #f8cdda, #1d2b64);
  color: white;
}

header img {
  max-width: 150px;
  border-radius: 15px;
}

h1 {
  font-family: 'Press Start 2P';
  font-size: 1.4em;
}

#cards {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px,1fr));
  gap: 20px;
  max-width: 1200px;
  margin: 20px auto;
}

.card {
  position: relative;
  height: 300px;
  border-radius: 15px;
  overflow: hidden;
  border: 3px solid #ffb6c1;
  background: #fff0f5;
}

.card img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.card .info {
  position: absolute;
  inset: 0;
  background: rgba(255,228,225,0.95);
  opacity: 0;
  padding: 10px;
  transition: .3s;
  overflow-y: auto;
  font-size: 0.85em;
}

.card:hover .info {
  opacity: 1;
}

#bandeau {
  position: fixed;
  top: 70px;
  left: 20px;
  background: white;
  border: 2px solid #ff69b4;
  border-radius: 12px;
  padding: 10px;
  display: none;
  z-index: 9999;
}

.sortie {
  display: flex;
  align-items: center;
  gap: 6px;
}

.sortie img {
  width: 24px;
  height: 24px;
  border-radius: 50%;
}
</style>
</head>

<body>

<nav id="navbar">
  <a href="index.html">ðŸ“‚ Collection</a>
  <a href="stats.html">ðŸ“Š Statistiques</a>
</nav>

<header>
  <img src="https://i.postimg.cc/wvPSqDzq/logo.jpg">
  <h1>Ma Collection de Boosters</h1>
</header>

<div id="bandeau">
  <div id="contenu-bandeau"></div>
</div>

<div id="cards">Chargementâ€¦</div>

<script>
/* ================== URL GOOGLE SHEETS ================== */
const sheetURL =
  "https://docs.google.com/spreadsheets/d/1Qu3UDfkrM2r4XgsyWBxZBlgQtaTw8TOy7CHlI--kSbU/gviz/tq?tqx=out:json&gid=658465532";

const sheetDonneesURL =
  "https://docs.google.com/spreadsheets/d/1Qu3UDfkrM2r4XgsyWBxZBlgQtaTw8TOy7CHlI--kSbU/gviz/tq?tqx=out:json&sheet=DONNEES";

/* ================== VARIABLES ================== */
let allCards = [];
let sorties = [];

/* ================== FORMAT DATE FR ================== */
function formatDateFR(value) {
  if (!value) return "";
  if (typeof value === "string") return value.trim();

  const d = new Date(value);
  if (isNaN(d)) return "";

  return new Intl.DateTimeFormat("fr-FR", {
    day: "numeric",
    month: "long",
    year: "numeric"
  }).format(d);
}

/* ================== CHARGER SORTIES ================== */
function chargerSorties() {
  return fetch(sheetDonneesURL)
    .then(res => res.text())
    .then(text => {
      const json = JSON.parse(text.substr(47).slice(0, -2));
      sorties = json.table.rows
        .map(r => ({
          serie: r.c[0]?.v?.trim() || "",
          date: formatDateFR(r.c[2]?.f || r.c[2]?.v || "")
        }))
        .filter(s => s.serie && s.date);
    });
}

/* ================== AFFICHER CARTES ================== */
function renderCards() {
  const container = document.getElementById("cards");

  container.innerHTML = allCards.map(c => `
    <div class="card">
      <img src="${c.image || 'https://via.placeholder.com/400x600?text=Pas+dâ€™image'}">
      <div class="info">
        <b>${c.nomSet}</b><br>
        SÃ©rie : ${c.serie}<br>
        Booster : ${c.booster}<br>
        AnnÃ©e : ${c.annee}<br>
        Langue : ${c.langue}<br>
        Type : ${c.type}
      </div>
    </div>
  `).join("");
}

/* ================== BANDEAU ================== */
function afficherBandeauSheet() {
  if (!sorties.length) return;

  const cont = document.getElementById("contenu-bandeau");
  cont.innerHTML = "";

  sorties.forEach(s => {
    const img = allCards.find(c => c.serie === s.serie)?.image || "";
    cont.innerHTML += `
      <div class="sortie">
        <img src="${img}">
        <strong>${s.serie}</strong> : ${s.date}
      </div>`;
  });

  bandeau.style.display = "block";
  setTimeout(() => bandeau.style.display = "none", 120000);
}

/* ================== CHARGEMENT GLOBAL ================== */
Promise.all([
  fetch(sheetURL)
    .then(res => res.text())
    .then(text => {
      const json = JSON.parse(text.substr(47).slice(0, -2));
      allCards = json.table.rows.map(r => ({
        serie: r.c[0]?.v || "",
        nomSet: r.c[1]?.v || "",
        booster: r.c[2]?.v || "",
        annee: r.c[3]?.v || "",
        langue: r.c[5]?.v || "",
        type: r.c[6]?.v || "",
        image: r.c[9]?.v || ""
      }));
      renderCards(); // âœ… IMPORTANT
    }),
  chargerSorties()
]).then(afficherBandeauSheet);
</script>

</body>
</html>
